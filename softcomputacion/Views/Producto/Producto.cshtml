
@{
    ViewBag.Title = "Producto";
    Layout = "~/Views/Shared/_UsuarioLogueado.cshtml";
    softcomputacion.Models.producto oProducto = (softcomputacion.Models.producto)ViewBag.oProducto;
    List<softcomputacion.Models.categoria> lstCategorias = (List<softcomputacion.Models.categoria>)ViewBag.lstCategorias;
    List<softcomputacion.Models.proveedor> lstProveedores = (List<softcomputacion.Models.proveedor>)ViewBag.lstProveedores;
}
<br /><br />
<div class="container-fluid">
    <div class="row">
        <div class="col-12 col-lg-8 offset-lg-2 text-center">
            <h2>Nuevo producto</h2>
        </div>
    </div>
    <hr style="border-top: 2px solid rgb(220, 53, 69);" />
    <br />
    <div class="row container-fluid">
        <div class="col-12 col-md-10 offset-md-1 col-lg-8 offset-lg-2">
            <form class="validate-form row" method="post" action="@Url.Action("GuardarModificarProducto","Producto")" autocomplete="off">
                @Html.AntiForgeryToken()
                <input name="oProducto.idProducto" value="@oProducto.idProducto" class="dis-none">

                <div class="col-12 col-md-6">
                    <label for="frmNombre">Nombre producto</label>
                    <div class="wrap-input100 validate-input m-b-20" data-validate="Nombre">
                        <input id="frmNombre" class="input100" type="text" name="oProducto.nombre" placeholder="Nombre" value="@oProducto.nombre">
                    </div>
                </div>
                <div class="col-12 col-md-6">
                    <label for="frmNombre">Precio costo</label>
                    <div class="wrap-input100 validate-input m-b-20" data-validate="Precio Costo">
                        <input id="frmPrecioCosto" class="input100" type="number" name="oProducto.precioCosto" placeholder="Ideal" value="@oProducto.precioCosto">
                    </div>
                </div>

                <div class="col-12 col-md-6">
                    <label >Categoría</label>
                    <div class="wrap-input100 validate-input m-b-20" data-validate="">
                        <select id="select-Categorias" onchange="CargarComboSubcategoria()" class="form-control input100" style="border:0px; height: 55px;" name="oProducto.idCategoria">
                            <option selected value="0">Categoría</option>
                            @{
                                foreach (softcomputacion.Models.categoria oCategoria in lstCategorias)
                                {
                                    <option value="@oCategoria.idCategoria">@oCategoria.nombre</option>
                                }
                            }
                        </select>
                    </div>

                </div>
                <div class="col-12 col-md-6">
                    <label >Sub categoría</label>
                    <div class="wrap-input100 validate-input m-b-20" data-validate="">
                        <select disabled id="select-Subcategoria" onchange="SeleccionarSubcategoria()" class="form-control input100" style="border:0px; height: 55px;" name="oProducto.idSubCategoria">
                            <option value="0">Subcategoria</option>
                        </select>
                    </div>
                </div>

                <div class="col-12">
                    <div class="row fs-14" id="subcategorias-agregadas">
                        @*<div id="div-categoria-1" class="col-12 col-md-6">
                            <div class="categoria-seleccionada">
                                <span style="float:right">
                                    <a style="cursor:pointer" onclick="EliminarCategoria(1)">
                                        <i class="far fa-times-circle" aria-hidden="true"></i>
                                    </a>
                                </span>
                                <p style="margin-bottom: 0px;">Categoria1 / Subcategoría2</p>
                            </div>
                        </div>*@
                       


                    </div>
                </div>
                

                <div class="col-12">
                    <label for="frmNombre">Observación</label>
                    <div class="wrap-input100 m-b-20">
                        <textarea class="input100 p-t-15" style="height:100px" type="text" name="oProducto.observacion" placeholder="Observacion" value="@oProducto.observacion"></textarea>
                    </div>
                </div>
                
                

                <!--stock-->

                <div class="col-12 text-center">
                    <br />
                    <span class="badge fs-20 p-b-5 p-t-5 p-l-20 p-r-20 m-b-5" style="background-color:#dc3545; color:#fff;">STOCK</span>
                </div>
                <div class="col-12 col-md-4">
                    <label for="frmStockMinimo">Mínimo</label>
                    <div class="wrap-input100 validate-input m-b-20" data-validate="Stock Minimo">
                        <input id="frmStockMinimo" class="input100" type="number" name="oProducto.stockMinimo" placeholder="Mínimo" value="@oProducto.stockMinimo">
                    </div>
                </div>
                <div class="col-12 col-md-4">
                    <label for="frmStockActual">Actual</label>
                    <div class="wrap-input100 validate-input m-b-20" data-validate="Stock Actual">
                        <input id="frmStockActual" class="input100" type="number" name="oProducto.stockActual" placeholder="Actual" value="@oProducto.stockActual">
                    </div>
                </div>
                <div class="col-12 col-md-4">
                    <label for="frmStockIdeal">Ideal</label>
                    <div class="wrap-input100 validate-input m-b-20" data-validate="Stock Ideal">
                        <input id="frmStockIdeal" class="input100" type="number" name="oProducto.stockIdeal" placeholder="Ideal" value="@oProducto.stockIdeal">
                    </div>
                </div>

                <!--precios-->
                
                <div class="col-12 text-center">
                    <br />
                    <span class="badge fs-20 p-b-5 p-t-5 p-l-20 p-r-20 m-b-5" style="background-color:#dc3545; color:#fff;">PRECIOS</span>
                </div>

                <div class="col-12 col-md-4">
                    <label for="frmPrecioContado">Contado</label>
                    <div class="wrap-input100 validate-input m-b-20" data-validate="Precio Contado">
                        <input id="frmPrecioContado" class="input100" type="number" name="oProducto.precioContado" placeholder="Precio contado" value="@oProducto.precioContado">
                    </div>
                </div>
                <div class="col-12 col-md-4">
                    <label for="frmPrecioLista">Lista</label>
                    <div class="wrap-input100 validate-input m-b-20" data-validate="Precio Lista">
                        <input id="frmPrecioLista" class="input100" type="number" name="oProducto.precioLista" placeholder="Precio lista" value="@oProducto.precioLista">
                    </div>
                </div>
                <div class="col-12 col-md-4">
                    <label for="frmPrecioGremio">Gremio</label>
                    <div class="wrap-input100 validate-input m-b-20" data-validate="Precio Gremio">
                        <input id="frmPrecioGremio" class="input100" type="number" name="oProducto.precioGremio" placeholder="Precio gremio" value="@oProducto.precioGremio">
                    </div>
                </div>

                <!--proveedor-->

                <div class="col-12 text-center">
                    <br />
                    <span class="badge fs-20 p-b-5 p-t-5 p-l-20 p-r-20 m-b-5" style="background-color:#dc3545; color:#fff;">PROVEEDORES</span>
                </div>
                <div class="col-12">
                    <label >Proveedores</label>
                    <div class="wrap-input100 validate-input m-b-20" data-validate="">
                        <select class="form-control input100" style="border:0px; height: 55px;" name="oProveedorxProducto.idProveedor">
                            <option value="0">Proveedores</option>
                            @{
                                foreach (softcomputacion.Models.proveedor oProveedor in lstProveedores)
                                {
                                    <option value="@oProveedor.idProveedor">@oProveedor.nombreEmpresa</option>
                                }
                            }
                        </select>
                    </div>
                </div>
                

               

                <div class="col-12 col-md-10 offset-md-1 col-lg-8 offset-lg-2">
                    <div class="container-login100-form-btn">
                        @*<div id="btnModificar" class="btn-group w-full" role="group">
                            <button type="reset" class="btn btn-dark" style="width:50%" onclick="CancelarModificar()">Cancelar</button>
                            <button type="submit" class="btn btn-success" style="width:50%">Modificar</button>
                        </div>*@
                        <button id="btnGuardar" type="submit" class="btn btn-success" style="width:100%">Guardar</button>
                    </div>
                </div>
                <br />
                <br />
                <br />
            </form>
        </div>
    </div>
</div>

@section scripts{
<script>

    $(document).ready(function () {
        var idProducto = '@oProducto.idProducto';
        if (idProducto == 0 || idProducto == null) {
            $(':input[type="number"]').val('');
           // $(":input").val('');
        }
    });

    //********** Categoria **********

    function CargarComboSubcategoria() {
        var url = "@Url.Action("ObtenerSubcategoriaDeCategoria", "Producto")";
        var idCategoria = document.getElementById("select-Categorias").value;
        var data = { idCategoria: idCategoria };
        $.post(url, data).done(function (data) {
            if (data == "<option selected value=\"0\">Subcategoria</option>" | data == "") {
                document.getElementById("select-Subcategoria").innerHTML = "<option selected value=\"0\">Subcategoria</option>";
                document.getElementById("select-Subcategoria").setAttribute("disabled", "true");
            }
            else {
                document.getElementById("select-Subcategoria").innerHTML = data + "";
                document.getElementById("select-Subcategoria").removeAttribute("disabled");
            }
        });
    }

    function SeleccionarSubcategoria()
    {
        var NombreCategoria = $("#select-Categorias option:selected").text();
        var idSubcategoria = document.getElementById("select-Subcategoria").value;
        var NombreSubcategoria = $("#select-Subcategoria option:selected").text();
        var ExisteSubcategoria = false;
        $("#subcategorias-agregadas div").each(function () {
            var idSubcategoriaAgregada = $(this).attr("id");
            if (idSubcategoriaAgregada == "div-categoria-" + idSubcategoria) {
                ExisteSubcategoria = true;
            }
        });
        if (ExisteSubcategoria) {
            swal("Subcategoria ya seleccionada.", "La subcategoria " + NombreSubcategoria + " ya ha sido asignado.", "info");
        } else {
            $('#subcategorias-agregadas').append("<div id=\"div-categoria-" + idSubcategoria + "\" class=\"col-12 col-md-6\"><div class=\"categoria-seleccionada\" ><span style=\"float:right\"><a style=\"cursor:pointer\" onclick=\"EliminarCategoria(" + idSubcategoria + ")\"><i class=\"far fa-times-circle\" aria-hidden=\"true\"></i></a></span><p style=\"margin-bottom: 0px;\">" + NombreCategoria + " / " + NombreSubcategoria + "</p></div></div>");
        }
        $("#select-Categorias").val(0);
        $("#select-Categorias").change();
    }

    function EliminarCategoria(id_categoria) {
        $('#div-categoria-' + id_categoria).remove();
    }

    //********** FIN categorias **********


</script>
}


